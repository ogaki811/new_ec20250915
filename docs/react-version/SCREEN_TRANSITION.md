# 画面遷移図

## 📊 全体サイトマップ

```
┌─────────────────────────────────────────────────────────────────┐
│                         ECサイト                                 │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ├─ 認証フロー
                              │   ├─ Login (ログイン)
                              │   ├─ Signup (サインアップ)
                              │   └─ (認証後) → Home
                              │
                              ├─ メインフロー
                              │   ├─ Home (トップページ)
                              │   │   ├─ HeroSlider (メインスライダー)
                              │   │   ├─ おすすめ商品 (6列グリッド)
                              │   │   ├─ カテゴリー一覧
                              │   │   └─ 新着情報
                              │   │
                              │   ├─ ProductDetail (商品詳細) ← 今後実装
                              │   │
                              │   ├─ Cart (カート)
                              │   │   └─ Checkout (購入手続き) ← 今後実装
                              │   │
                              │   └─ OrderComplete (注文完了) ← 今後実装
                              │
                              └─ マイページフロー
                                  └─ MyPage (マイページダッシュボード)
                                      ├─ OrderHistory (注文履歴)
                                      ├─ Favorites (お気に入り)
                                      └─ AccountSettings (アカウント設定) ← 今後実装
```

---

## 🔀 詳細画面遷移図

### 1. 認証フロー

```
┌──────────┐
│  未認証  │
└────┬─────┘
     │
     ├─→ Login ──────────────┐
     │    │                  │
     │    ├─ ログイン成功 ────┤
     │    └─ パスワード忘れ   │
     │         (別途実装)     │
     │                       ↓
     └─→ Signup ──────────→ Home
          │                (認証済み)
          └─ 規約確認
             利用規約表示
```

**ルート:**
- `/login` - ログイン画面
- `/signup` - サインアップ画面
- `/` - ホーム（認証後遷移）

**遷移条件:**
- ログイン成功 → Home
- サインアップ成功 → Home（自動ログイン）
- 認証エラー → エラーメッセージ表示

---

### 2. トップページ → 商品詳細フロー

```
┌─────────────────────────────────────────────────┐
│               Home (/)                          │
│                                                 │
│  ┌────────────────────────────────────┐         │
│  │  HeroSlider (3枚表示)              │         │
│  │  - クリック → 各特集ページ          │         │
│  └────────────────────────────────────┘         │
│                                                 │
│  ┌────────────────────────────────────┐         │
│  │  おすすめ商品 (6列グリッド)        │         │
│  │  ┌──────┐ ┌──────┐ ┌──────┐       │         │
│  │  │商品1 │ │商品2 │ │商品3 │ ...   │         │
│  │  └──┬───┘ └──┬───┘ └──┬───┘       │         │
│  └─────┼────────┼────────┼───────────┘         │
│        │        │        │                      │
│        └────────┴────────┴──────┐               │
└─────────────────────────────────┼───────────────┘
                                  │
                                  ↓
                         ┌─────────────────┐
                         │ ProductDetail   │
                         │  (商品詳細)     │
                         │                 │
                         │ - 商品画像      │
                         │ - 商品情報      │
                         │ - 価格          │
                         │ - 数量選択      │
                         │ - [カート追加]  │
                         └────────┬────────┘
                                  │
                                  ↓
                              ┌──────┐
                              │ Cart │
                              └──────┘
```

**ルート:**
- `/` - トップページ
- `/product/:id` - 商品詳細（今後実装）
- `/cart` - カート

**遷移:**
- 商品カードクリック → 商品詳細
- カートに追加 → カートへ遷移（または同じページでトースト表示）
- ヘッダーのカートアイコン → カート

---

### 3. カート → 購入フロー

```
┌──────────────────────────────────────────────────┐
│               Cart (/cart)                       │
│                                                  │
│  ┌────────────────────┐  ┌──────────────────┐   │
│  │  カート商品リスト   │  │  CartSummary     │   │
│  │                    │  │  ・小計          │   │
│  │  ┌──────────────┐  │  │  ・送料          │   │
│  │  │ CartItem 1   │  │  │  ・合計          │   │
│  │  │ - 商品画像   │  │  │                  │   │
│  │  │ - 商品名     │  │  │  [購入手続きへ]  │   │
│  │  │ - 数量変更   │  │  └────────┬─────────┘   │
│  │  │ - 削除       │  │           │              │
│  │  └──────────────┘  │           │              │
│  │  ┌──────────────┐  │           │              │
│  │  │ CartItem 2   │  │           │              │
│  │  └──────────────┘  │           │              │
│  └────────────────────┘           │              │
└───────────────────────────────────┼──────────────┘
                                    │
                                    ↓
                          ┌─────────────────┐
                          │  Checkout       │
                          │  (購入手続き)   │ ← 今後実装
                          │                 │
                          │ - 配送先情報    │
                          │ - 支払い方法    │
                          │ - 注文確認      │
                          └────────┬────────┘
                                   │
                                   ↓
                          ┌─────────────────┐
                          │ OrderComplete   │
                          │  (注文完了)     │ ← 今後実装
                          └─────────────────┘
```

**ルート:**
- `/cart` - カート
- `/checkout` - 購入手続き（今後実装）
- `/order-complete` - 注文完了（今後実装）

**遷移:**
- 購入手続きへ → Checkout
- 注文確定 → OrderComplete
- 買い物を続ける → Home

---

### 4. マイページフロー

```
┌───────────────────────────────────────────────────────────┐
│                   MyPage (/mypage)                        │
│                                                           │
│  ┌────────────┐  ┌─────────────────────────────────┐     │
│  │  Sidebar   │  │  Dashboard                      │     │
│  │            │  │                                 │     │
│  │  ・注文履歴│  │  ┌──────────────────┐           │     │
│  │  ・お気に入│  │  │ ユーザー情報      │           │     │
│  │  ・設定    │  │  └──────────────────┘           │     │
│  │            │  │                                 │     │
│  └────────────┘  │  ┌──────────────────┐           │     │
│                  │  │ 最近の注文        │           │     │
│                  │  └──────────────────┘           │     │
│                  │                                 │     │
│                  │  ┌──────────────────┐           │     │
│                  │  │ おすすめ商品      │           │     │
│                  │  └──────────────────┘           │     │
│                  └─────────────────────────────────┘     │
└───────────────────────────────────────────────────────────┘
           │                  │                  │
           │                  │                  │
           ↓                  ↓                  ↓
    ┌─────────────┐  ┌─────────────┐  ┌─────────────┐
    │OrderHistory │  │  Favorites  │  │  Settings   │
    │ (注文履歴)  │  │(お気に入り) │  │  (設定)     │
    │             │  │             │  │             │
    │ - フィルター│  │ - 商品グリッド│ │ - プロフィール│
    │ - 検索      │  │ - お気に入り  │ │ - パスワード │
    │ - ページング│  │   解除        │ │ - 通知設定   │
    └─────────────┘  └─────────────┘  └─────────────┘
           │                                    ↑
           │                              (今後実装)
           ↓
    ┌─────────────┐
    │OrderDetail  │
    │ (注文詳細)  │ ← 今後実装
    │             │
    │ - 商品一覧  │
    │ - 配送状況  │
    │ - 請求書    │
    └─────────────┘
```

**ルート:**
- `/mypage` - マイページダッシュボード
- `/mypage/order-history` または `/order-history` - 注文履歴
- `/mypage/favorites` または `/favorites` - お気に入り
- `/mypage/settings` - 設定（今後実装）
- `/mypage/order/:id` - 注文詳細（今後実装）

**遷移:**
- サイドバーメニュークリック → 各ページ
- 注文カードクリック → 注文詳細
- 商品カードクリック → 商品詳細

---

## 🔗 グローバルナビゲーション（ヘッダー）

```
┌─────────────────────────────────────────────────────────────┐
│  [ロゴ]  [検索]  [ホーム] [カテゴリ] [ログイン] [カート]     │
└─────────────────────────────────────────────────────────────┘
    │         │        │         │          │          │
    ↓         │        │         │          │          │
  Home        │        │         │          │          │
              │        │         │          │          │
              ↓        │         │          │          │
         検索結果       │         │          │          │
         (今後実装)     │         │          │          │
                       │         │          │          │
                       ↓         │          │          │
                     Home        │          │          │
                                 │          │          │
                                 ↓          │          │
                            カテゴリー       │          │
                            (今後実装)      │          │
                                            │          │
                                            ↓          │
                                        Login          │
                                                       │
                                                       ↓
                                                     Cart
```

**どのページからでもアクセス可能:**
- ロゴクリック → Home
- 検索 → 検索結果（今後実装）
- ホーム → Home
- カテゴリー → カテゴリーページ（今後実装）
- ログイン → Login（未認証時）/ MyPage（認証済み時）
- カート → Cart

---

## 📱 モバイルナビゲーション

### ハンバーガーメニュー（モバイル時）

```
┌─────────────────┐
│  ☰ メニュー     │
└─────────────────┘
        │
        ↓
┌─────────────────┐
│  ・ホーム       │ → Home
│  ・カテゴリー   │ → カテゴリー一覧
│  ・マイページ   │ → MyPage
│  ・お気に入り   │ → Favorites
│  ・カート       │ → Cart
│  ・ログイン     │ → Login
│                 │
│  [検索バー]     │
└─────────────────┘
```

---

## 🎯 主要ユーザーフロー

### A. 初回訪問 → 購入フロー

```
1. Home (トップページ)
   ↓
2. 商品閲覧（おすすめ商品 or カテゴリー）
   ↓
3. ProductDetail (商品詳細)
   ↓
4. カートに追加
   ↓
5. Cart (カート確認)
   ↓
6. Signup (会員登録) ← 未登録の場合
   ↓
7. Checkout (購入手続き)
   ↓
8. OrderComplete (注文完了)
   ↓
9. MyPage (マイページ) or OrderHistory (注文履歴確認)
```

### B. 会員ログイン → 再購入フロー

```
1. Login (ログイン)
   ↓
2. MyPage (マイページ)
   ↓
3. OrderHistory (注文履歴)
   ↓
4. 過去の注文から再注文
   ↓
5. Cart (カート)
   ↓
6. Checkout (購入手続き)
   ↓
7. OrderComplete (注文完了)
```

### C. お気に入りから購入フロー

```
1. Favorites (お気に入り)
   ↓
2. 商品選択 → ProductDetail
   ↓
3. カートに追加
   ↓
4. Cart → Checkout → OrderComplete
```

---

## 📋 ページ一覧とルーティング

### 実装済みページ（Phase 1）

| ページ名 | ルート | 認証 | 説明 |
|---------|-------|------|------|
| **Home** | `/` | 不要 | トップページ・HeroSlider・おすすめ商品6列 |
| **Login** | `/login` | 不要 | ログイン画面 |
| **Signup** | `/signup` | 不要 | サインアップ画面 |
| **MyPage** | `/mypage` | 必要 | マイページダッシュボード |
| **OrderHistory** | `/order-history` | 必要 | 注文履歴一覧 |
| **Favorites** | `/favorites` | 必要 | お気に入り商品一覧 |
| **Cart** | `/cart` | 不要 | カート（未認証でも閲覧可能） |

### 今後実装予定ページ（Phase 2）

| ページ名 | ルート | 認証 | 説明 |
|---------|-------|------|------|
| **ProductDetail** | `/product/:id` | 不要 | 商品詳細ページ |
| **Checkout** | `/checkout` | 必要 | 購入手続き |
| **OrderComplete** | `/order-complete` | 必要 | 注文完了画面 |
| **OrderDetail** | `/order/:id` | 必要 | 注文詳細 |
| **Settings** | `/mypage/settings` | 必要 | アカウント設定 |
| **SearchResults** | `/search?q=keyword` | 不要 | 検索結果 |
| **Category** | `/category/:id` | 不要 | カテゴリー商品一覧 |

---

## 🔒 認証制御

### 認証不要ページ
- `/` (Home)
- `/login`
- `/signup`
- `/product/:id` (ProductDetail)
- `/cart` (Cart)
- `/search` (SearchResults)
- `/category/:id` (Category)

### 認証必要ページ
- `/mypage` (MyPage)
- `/order-history` (OrderHistory)
- `/favorites` (Favorites)
- `/checkout` (Checkout)
- `/order-complete` (OrderComplete)
- `/order/:id` (OrderDetail)
- `/mypage/settings` (Settings)

**未認証時のアクセス:**
→ Loginページへリダイレクト（`redirect_url`パラメータで元のページを保存）

**認証後:**
→ `redirect_url`があればそのページへ、なければ`/mypage`へ遷移

---

## 🎨 モーダル・オーバーレイ遷移

### モーダル表示（ページ遷移なし）

```
現在のページ
    │
    ├─ カートに追加成功
    │   → トーストメッセージ表示（3秒後消える）
    │
    ├─ お気に入り追加
    │   → ハートアイコンが塗りつぶし + トースト
    │
    └─ 削除確認
        → 確認モーダル表示
           [キャンセル] [削除]
```

---

## 📊 画面遷移マトリクス

| From / To | Home | Product | Cart | Login | Signup | MyPage | OrderHistory | Favorites |
|-----------|------|---------|------|-------|--------|--------|--------------|-----------|
| **Home** | - | 商品クリック | カートアイコン | ヘッダー | ヘッダー | ヘッダー | - | ヘッダー |
| **Product** | ロゴ | - | カート追加 | ヘッダー | ヘッダー | ヘッダー | - | お気に入り |
| **Cart** | ロゴ | 商品クリック | - | 購入手続き | 購入手続き | ヘッダー | - | ヘッダー |
| **Login** | ログイン成功 | - | - | - | サインアップ | ログイン成功 | - | - |
| **Signup** | 登録成功 | - | - | ログイン | - | 登録成功 | - | - |
| **MyPage** | ロゴ | おすすめ商品 | ヘッダー | ログアウト | - | - | サイドバー | サイドバー |
| **OrderHistory** | ロゴ | 商品クリック | ヘッダー | ログアウト | - | サイドバー | - | - |
| **Favorites** | ロゴ | 商品クリック | カート追加 | ログアウト | - | サイドバー | - | - |

---

## 🚀 Next.js App Router ルーティング構造

```
src/app/
├── layout.tsx              # ルートレイアウト（Header + Footer）
├── page.tsx                # "/" - Home
├── login/
│   └── page.tsx           # "/login"
├── signup/
│   └── page.tsx           # "/signup"
├── cart/
│   └── page.tsx           # "/cart"
├── product/
│   └── [id]/
│       └── page.tsx       # "/product/:id" (動的ルート)
├── mypage/
│   ├── layout.tsx         # マイページ共通レイアウト（Sidebar）
│   ├── page.tsx           # "/mypage"
│   └── settings/
│       └── page.tsx       # "/mypage/settings"
├── order-history/
│   └── page.tsx           # "/order-history"
├── favorites/
│   └── page.tsx           # "/favorites"
├── checkout/
│   └── page.tsx           # "/checkout"
├── order-complete/
│   └── page.tsx           # "/order-complete"
└── order/
    └── [id]/
        └── page.tsx       # "/order/:id" (動的ルート)
```

---

## ✅ 画面遷移実装チェックリスト

### Phase 1（実装済み）
- [x] Home → Login (ヘッダーリンク)
- [x] Home → Signup (ヘッダーリンク)
- [x] Login → Home (ログイン成功)
- [x] Signup → Home (登録成功)
- [x] Header → MyPage (認証済み時)
- [x] Header → Cart (カートアイコン)
- [x] Header → Favorites (ヘッダーリンク)
- [x] MyPage → OrderHistory (サイドバー)
- [x] MyPage → Favorites (サイドバー)

### Phase 2（今後実装）
- [ ] Home → ProductDetail (商品クリック)
- [ ] ProductDetail → Cart (カートに追加)
- [ ] Cart → Checkout (購入手続き)
- [ ] Checkout → OrderComplete (注文確定)
- [ ] OrderHistory → OrderDetail (注文クリック)
- [ ] Favorites → ProductDetail (商品クリック)
- [ ] Header → SearchResults (検索実行)
- [ ] Header → Category (カテゴリークリック)

### 認証制御
- [ ] 未認証でマイページアクセス → Login へリダイレクト
- [ ] 未認証で購入手続き → Login へリダイレクト
- [ ] ログイン成功 → 元のページへリダイレクト

### モバイル対応
- [ ] ハンバーガーメニューからの遷移
- [ ] ドロワーメニュー開閉
- [ ] モバイル検索バー表示

---

**すべての画面遷移を網羅した設計が完成しました。** 🎉
