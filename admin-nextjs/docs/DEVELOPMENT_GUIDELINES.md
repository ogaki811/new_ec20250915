# 開発ガイドライン

## 目次

- [プロジェクト概要](#プロジェクト概要)
- [技術スタック](#技術スタック)
- [機能要件](#機能要件)
- [開発規約](#開発規約)
- [更新履歴](#更新履歴)

---

## プロジェクト概要

**プロジェクト名**: Maestro Admin
**説明**: EC サイト運営のための管理画面システム
**開発開始日**: 2025-01-15
**最終更新日**: 2025-10-09

---

## 技術スタック

### フロントエンド
- **Next.js**: 15.5.4 (App Router)
- **React**: 19.1.0
- **TypeScript**: 5.x
- **Tailwind CSS**: v4 (@tailwindcss/postcss)

### 状態管理
- **Zustand**: 軽量な状態管理ライブラリ

### UI/UX
- **react-hot-toast**: トースト通知
- **ImageUpload**: カスタム画像アップロードコンポーネント

### 認証
- **bcryptjs**: パスワードハッシュ化

### その他
- **uuid**: ユニークID生成
- **date-fns**: 日付処理（必要に応じて追加予定）

---

## 機能要件

### 1. 認証システム

#### 1.1 ログイン機能
- **パス**: `/login`
- **機能**:
  - メールアドレス・パスワードによる認証
  - デモログインボタン（demo@example.com / password）
  - ログイン状態の保持
- **実装状況**: ✅ 完了

---

### 2. ダッシュボード

#### 2.1 統計情報表示
- **パス**: `/dashboard`
- **機能**:
  - 売上統計（本日・今月・今年）
  - 注文数統計
  - 顧客数統計
  - 商品数統計
  - 最近の注文一覧（直近10件）
- **実装状況**: ✅ 完了

---

### 3. 商品管理

#### 3.1 商品一覧
- **パス**: `/products`
- **機能**:
  - 商品一覧表示（ページネーション付き）
  - カテゴリ・在庫状況でフィルタリング
  - 商品検索
  - 商品の新規作成・編集・削除
- **実装状況**: ✅ 完了

#### 3.2 商品詳細・編集
- **パス**: `/products/new`, `/products/[id]/edit`
- **機能**:
  - 商品情報の入力・編集
    - 商品名
    - 説明
    - 価格
    - カテゴリ
    - 在庫数
    - ステータス（公開/非公開/在庫切れ）
  - メイン画像のアップロード（必須、1枚）
  - 追加画像のアップロード（任意、複数枚）
- **実装状況**: ✅ 完了

---

### 4. 注文管理

#### 4.1 注文一覧
- **パス**: `/orders`
- **機能**:
  - 注文一覧表示
  - ステータスでフィルタリング（全て/処理中/配送中/完了/キャンセル）
  - 注文詳細確認
- **実装状況**: ✅ 完了

---

### 5. 顧客管理

#### 5.1 顧客一覧
- **パス**: `/customers`
- **機能**:
  - 顧客一覧表示
  - ランク別フィルタリング（全て/ブロンズ/シルバー/ゴールド/プラチナ）
  - 顧客詳細確認
- **実装状況**: ✅ 完了

---

### 6. クーポン管理

#### 6.1 クーポン一覧
- **パス**: `/coupons`
- **機能**:
  - クーポン一覧表示
  - タイプ別フィルタリング（全て/割引率/固定割引/送料無料）
  - クーポンの有効期限表示
- **実装状況**: ✅ 完了

---

### 7. バナー管理

**詳細ドキュメント**: [BANNER_REQUIREMENTS.md](./BANNER_REQUIREMENTS.md)

バナー管理機能は、ECサイトの訪問者に対してキャンペーン情報やお知らせを効果的に伝えるための機能です。

#### 7.1 バナー一覧
- **パス**: `/settings/banners`
- **機能**:
  - バナー一覧表示（テーブル形式）
  - ステータス表示（予約中/公開中/期限切れ）
  - バナータイプ表示（情報/成功/警告/エラー）
  - 公開開始日時・終了日時の表示
  - プレビュー機能（モーダル表示）
  - バナーの削除
- **実装状況**: ✅ 完了

#### 7.2 バナー作成
- **パス**: `/settings/banners/new`
- **機能**:
  - バナー情報の入力
    - メッセージ（必須、最大500文字推奨）
    - バナータイプ（情報/成功/警告/エラー）
    - バナー画像（必須、最大5MB、推奨1200x200px）
    - アクションボタン（任意）
      - ボタンラベル
      - リンク先URL
    - 予約公開設定
      - 公開開始日時（任意）
      - 公開終了日時（任意）
  - リアルタイムプレビュー（折りたたみ可能）
  - バリデーション
    - メッセージ必須チェック
    - 画像必須チェック
    - 日付論理チェック（開始日時 < 終了日時）
- **実装状況**: ✅ 完了

#### 7.3 バナー編集
- **パス**: `/settings/banners/[id]/edit`
- **機能**: バナー作成と同様の機能、既存データの読み込み
- **実装状況**: ❌ 未実装（Phase 2で実装予定）

#### 7.4 バナーAPI
- **エンドポイント**:
  - `GET /api/settings/banners` - 一覧取得
  - `POST /api/settings/banners` - 作成
  - `GET /api/settings/banners/[id]` - 詳細取得
  - `PUT /api/settings/banners/[id]` - 更新（全体）
  - `PATCH /api/settings/banners/[id]` - 更新（部分）
  - `DELETE /api/settings/banners/[id]` - 削除
- **実装状況**: ✅ 完了

#### 7.5 予約公開機能
- **ステータス自動判定**:
  - **予約中**: 現在時刻 < 公開開始日時
  - **公開中**: 公開開始日時 ≤ 現在時刻 ≤ 公開終了日時（または日時指定なし）
  - **期限切れ**: 現在時刻 > 公開終了日時
- **表示制御**:
  - 画像は常に表示（必須）
  - 閉じるボタンは表示しない
  - ステータスは自動判定（予約公開機能による）
- **実装状況**: ✅ 完了

#### 7.6 データモデル
```typescript
interface BannerConfig {
  id: string;                      // バナーID（UUID v4）
  message: string;                 // メッセージ本文（必須）
  variant: BannerVariant;          // バナータイプ（必須）
  imageUrl: string;                // 画像URL（必須）
  actionLabel?: string;            // ボタンラベル（任意）
  actionUrl?: string;              // リンク先URL（任意）
  publishStartDate?: string;       // 公開開始日時（任意、ISO 8601）
  publishEndDate?: string;         // 公開終了日時（任意、ISO 8601）
  createdAt: string;               // 作成日時（ISO 8601）
  updatedAt: string;               // 更新日時（ISO 8601）
}

type BannerVariant = 'info' | 'success' | 'warning' | 'error';
type BannerStatus = 'scheduled' | 'active' | 'expired';
```

#### 7.7 フロントエンド（顧客側）表示
- **機能**: サイト訪問者へのバナー表示
- **実装状況**: ❌ 未実装（Phase 3で実装予定）
- **予定機能**:
  - ヘッダー直下へのバナー配置
  - 公開中バナーの自動表示
  - レスポンシブ対応
  - 複数バナーの表示制御

#### 7.8 今後の拡張（Phase 4）
- 表示順序管理
- 表示条件管理（URL、デバイス、ユーザー属性）
- クリック率の計測
- A/Bテスト機能
- バナーテンプレート

---

### 8. 画像アップロード機能

#### 8.1 画像アップロードコンポーネント
- **コンポーネント**: `ImageUpload`
- **機能**:
  - ドラッグ&ドロップ対応
  - ファイル選択ボタン
  - 画像プレビュー
  - 複数画像対応
  - 画像削除機能
  - ファイルサイズ制限（5MB）
  - 対応形式: JPEG, PNG, GIF, WebP
- **実装状況**: ✅ 完了

#### 8.2 画像アップロードAPI
- **エンドポイント**: `POST /api/upload`
- **機能**:
  - ファイルサイズチェック（5MB以下）
  - ファイル形式チェック
  - UUID による一意なファイル名生成
  - `/public/uploads` への保存
- **実装状況**: ✅ 完了

---

## 開発規約

### コーディング規約

#### 1. ファイル構成
```
src/
├── app/                    # Next.js App Router
│   ├── (authenticated)/   # 認証が必要なページ
│   ├── api/               # APIルート
│   └── login/             # ログインページ
├── components/            # コンポーネント
│   ├── admin/            # 管理画面専用コンポーネント
│   └── ui/               # 再利用可能なUIコンポーネント
├── data/                 # 開発用JSONデータ
├── lib/                  # ユーティリティ・ヘルパー
├── store/                # Zustand ストア
└── styles/               # グローバルスタイル
```

#### 2. コンポーネント設計
- **UI コンポーネント**:
  - `src/components/ui/` に配置
  - 再利用可能で汎用的な設計
  - Props による柔軟なカスタマイズ
  - TypeScript で型定義を必須化

- **管理画面コンポーネント**:
  - `src/components/admin/` に配置
  - 管理画面固有のロジックを含む

#### 3. スタイリング
- **Tailwind CSS v4 使用**:
  - `@import` シンタックス
  - `@tailwindcss/postcss` 使用
  - カスタムカラーは `tailwind.config.ts` で定義

- **グローバルスタイル**:
  - `src/styles/globals.css` に配置
  - 管理画面用のユーティリティクラスを定義
    - `.admin-container`
    - `.admin-table`
    - `.admin-card`

#### 4. 状態管理
- **Zustand** を使用:
  - グローバルな状態のみストアで管理
  - ローカルな状態は `useState` を使用
  - ストアは機能ごとに分割（例: `authStore.ts`）

#### 5. API設計
- **ファイルベースのデータ保存**（開発環境）:
  - データは `src/data/*.json` に保存
  - 本番環境では API を実装予定

- **エンドポイント命名規則**:
  - RESTful な設計
  - `/api/[リソース名]` の形式
  - 例: `/api/products`, `/api/orders`, `/api/settings/banners`

#### 6. 型定義
- **TypeScript 必須**:
  - すべてのコンポーネント・関数に型定義
  - `interface` または `type` でデータ構造を定義
  - Props の型定義を明示

#### 7. バリデーション
- **フロントエンド**:
  - 必須項目チェック
  - フォーマットチェック（URL、日付など）
  - 日付の論理チェック（開始日 < 終了日）

- **バックエンド**:
  - API でも同様のバリデーションを実施
  - エラーメッセージを日本語で返す

#### 8. エラーハンドリング
- **react-hot-toast** を使用:
  - 成功: `toast.success()`
  - エラー: `toast.error()`
  - 情報: `toast()`

---

### Git運用規約

#### 1. コミットメッセージ
- **フォーマット**:
  ```
  <type>: <subject>

  <body>

  🤖 Generated with [Claude Code](https://claude.com/claude-code)

  Co-Authored-By: Claude <noreply@anthropic.com>
  ```

- **Type の種類**:
  - `feat`: 新機能追加
  - `fix`: バグ修正
  - `refactor`: リファクタリング
  - `style`: スタイル変更（コードの動作に影響しない）
  - `docs`: ドキュメント変更
  - `test`: テスト追加・修正
  - `chore`: ビルドプロセスや補助ツールの変更

#### 2. ブランチ戦略
- **main**: 本番環境用
- **feature/***: 新機能開発
- **fix/***: バグ修正
- **refactor/***: リファクタリング

---

### UI/UX規約

#### 1. デザインシステム
- **カラーパレット**:
  - Primary: Blue (#3b82f6)
  - Success: Green (#10b981)
  - Warning: Yellow (#f59e0b)
  - Error: Red (#ef4444)
  - Gray: (#6b7280, #9ca3af, #d1d5db, #e5e7eb, #f3f4f6)

- **アイコン**:
  - デザインシステムのアイコンを使用
  - カラフルなものは避け、単色を推奨
  - `Icon` コンポーネントを使用

#### 2. レスポンシブデザイン
- モバイルファーストの設計
- ブレークポイント: sm (640px), md (768px), lg (1024px), xl (1280px)

#### 3. アクセシビリティ
- ラベルは必ず付ける
- キーボード操作に対応
- 適切なセマンティック HTML を使用

---

### テスト規約

#### 1. テスト方針
- **現状**: 手動テストのみ
- **今後**: 自動テストの導入を検討
  - Unit テスト（Jest + React Testing Library）
  - E2E テスト（Playwright）

---

## 更新履歴

### 2025-10-09
- **バナー管理機能の実装完了**
  - 予約公開機能の追加
  - 画像必須化
  - チェックボックスの削除（有効化、閉じるボタン、画像表示）
  - ステータスの自動判定（予約中/公開中/期限切れ）
  - バナー一覧での日時表示

### 2025-01-15
- **プロジェクト開始**
  - Next.js 15 + React 19 + TypeScript 構成
  - Tailwind CSS v4 対応
  - 認証システム実装
  - 管理画面レイアウト（Header + Sidebar）
  - 商品管理機能（CRUD, フィルター, ページネーション）
  - 注文管理機能（一覧, フィルター）
  - 顧客管理機能（一覧, ランク別フィルター）
  - クーポン管理機能（一覧, タイプ別フィルター）
  - ダッシュボード（統計表示, 最近の注文）
  - UI コンポーネント（Button, Input, Select, Badge等）
  - 画像アップロード機能

---

## 今後の計画

### 短期（1-2週間）
- [ ] 編集画面の実装（注文、顧客、クーポン）
- [ ] バナー編集画面の実装
- [ ] データ永続化（Database 導入）

### 中期（1-2ヶ月）
- [ ] ユーザー管理機能
- [ ] 権限管理機能
- [ ] レポート機能
- [ ] 通知機能

### 長期（3ヶ月以上）
- [ ] API の本格実装
- [ ] テスト自動化
- [ ] パフォーマンス最適化
- [ ] セキュリティ強化

---

**注意**: このドキュメントは開発の進行に伴い継続的に更新されます。新機能の追加や変更があった場合は、必ずこのドキュメントを更新してください。
